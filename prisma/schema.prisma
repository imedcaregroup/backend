// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



model User {
  id      Int      @id @default(autoincrement())
  email   String?  @unique
  password    String?
  authProvider String
  googleId String?
  mobileNumber String?
  otp Int?
  name String? 
  surName String?
  pytroNym String?
  dob DateTime?
  gender String?
  country String?
  address String?
  lat Float?
  lng Float?
  notificationEnabled Boolean  @default(false)
  orders Order[]
  addresses Address[]
  isDeleted Boolean? @default(false)
  imageUrl String? @default("https://thumbs.dreamstime.com/b/profile-anonymous-face-icon-gray-silhouette-person-male-default-avatar-photo-placeholder-white-background-vector-illustration-106473768.jpg")
}


model Service{
   id      Int      @id @default(autoincrement())
   iconUrl String
   name    String
   categories   Category[]
   orders      OrderSubCategory[]
}



model Category{
   id      Int      @id @default(autoincrement())
   iconUrl String
   name    String
   serviceId   Int    
   service     Service   @relation(fields: [serviceId], references: [id]) 
   subcategories   SubCategory[]
   orders      OrderSubCategory[]
}



model SubCategory {
  id                  Int                  @id @default(autoincrement())
  iconUrl             String
  name                String
  categoryId          Int
  category            Category             @relation(fields: [categoryId], references: [id])
  medicalCategories   MedicalCategory[]
   orders              OrderSubCategory[]   @relation("SubCategoryOrders")
  orderSubCategories  OrderSubCategory[]   @relation("SubCategoryOrderSubCategories")
}


model Medical{
   id      Int      @id @default(autoincrement())
   iconUrl String
   name    String
   lat  Float
   lng Float
   address String 
   services  Json 
   contact Int? 
   medicalCatrgories MedicalCategory[]
   orders Order[]
   availabilities Availability[]
}


model MedicalCategory{
   id      Int      @id @default(autoincrement())
   medicalId Int
   subCategoryId Int
   createdAt         DateTime         @default(now())
   medical           Medical          @relation(fields: [medicalId], references: [id])
   subCategory       SubCategory       @relation(fields: [subCategoryId], references: [id])
   price    Float @default(0)
}



model Order {
  id                  Int                @id @default(autoincrement())
  createdAt           DateTime           @default(now())
  medicalId           Int
  userId              Int
  price               Float              @default(0)
  address             String?
  lat                 Float?
  lng                 Float?
  paymetStatus       String             @default("pending")
  orderStatus         String             @default("pending")
  declinedReason      String?
  additionalInfo      String?
  orderDate           DateTime
  fileUrl             Json?

  date                String?
  startTime           Int?
  endTime             Int?
  doctor              String?

  medical             Medical            @relation(fields: [medicalId], references: [id])
  user                User               @relation(fields: [userId], references: [id])
  orderSubCategories  OrderSubCategory[]
}

model OrderSubCategory {
   id                Int          @id @default(autoincrement())
   orderId           Int
   serviceId         Int
   categoryId        Int
   subCategoryId     Int
   subCategory       SubCategory  @relation("SubCategoryOrderSubCategories", fields: [subCategoryId], references: [id], map: "OrderSubCategory_subCategoryId_to_SubCategory") // Unique constraint name
   orders            SubCategory  @relation("SubCategoryOrders", fields: [subCategoryId], references: [id], map: "OrderSubCategory_subCategoryId_to_Orders") // Unique constraint name
   order             Order        @relation(fields: [orderId], references: [id]) // Relation with Order
   service           Service      @relation(fields: [serviceId], references: [id]) // Relation with Service
   category          Category     @relation(fields: [categoryId], references: [id]) // Relation with Category
}


model Availability{
   id  Int @id @default(autoincrement())
   createdAt DateTime @default(now())
   day Int
   startTime Int
   endTime Int
   medicalId Int
   medical Medical  @relation(fields: [medicalId], references: [id])
}

model Address{
   id  Int @id @default(autoincrement())
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
   shortName String
   city String
   district String
   address String
   userId Int
   lat Int
   lng Int
   user       User       @relation(fields: [userId], references: [id])
}