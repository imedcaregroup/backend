generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  Int        @id @default(autoincrement())
  email               String?    @unique
  password            String?
  mobileNumber        String?
  otp                 Int?
  name                String?
  surName             String?
  pytroNym            String?
  dob                 DateTime?
  address             String?    @default("None")
  authProvider        String
  googleId            String?
  notificationEnabled Boolean    @default(false)
  country             String?
  gender              String?
  lat                 Float?
  lng                 Float?
  isDeleted           Boolean?   @default(false)
  imageUrl            String?    @default("https://thumbs.dreamstime.com/b/profile-anonymous-face-icon-gray-silhouette-person-male-default-avatar-photo-placeholder-white-background-vector-illustration-106473768.jpg")
  addresses           Address[]
  orders              Order[]
  tokens              FcmToken[]
  employee            Employee?
}

model Service {
  id         Int                @id @default(autoincrement())
  iconUrl    String
  name       String
  categories Category[]
  Order      Order[]
  orders     OrderSubCategory[]
}

model Category {
  id            Int                @id @default(autoincrement())
  iconUrl       String
  name          String
  serviceId     Int
  service       Service            @relation(fields: [serviceId], references: [id])
  Order         Order[]
  orders        OrderSubCategory[]
  subcategories SubCategory[]
}

model SubCategory {
  id                 Int                @id @default(autoincrement())
  iconUrl            String
  name               String
  name_en            String?
  name_az            String?
  name_ru            String?
  categoryId         Int
  medicalCategories  MedicalCategory[]
  orderSubCategories OrderSubCategory[] @relation("SubCategoryOrderSubCategories")
  category           Category           @relation(fields: [categoryId], references: [id])
}

model Medical {
  id                Int               @id @default(autoincrement())
  iconUrl           String
  name              String
  lat               Float
  lng               Float
  address           String
  services          String?
  contact           Int?
  availabilities    Availability[]
  medicalCatrgories MedicalCategory[]
  orders            Order[]
  adminId           Int?
  admin             Admin?            @relation("AdminMedical", fields: [adminId], references: [id])
  employees         Employee[]
}

model MedicalCategory {
  id            Int         @id @default(autoincrement())
  medicalId     Int
  subCategoryId Int
  createdAt     DateTime    @default(now())
  price         Float       @default(0)
  medical       Medical     @relation(fields: [medicalId], references: [id])
  subCategory   SubCategory @relation(fields: [subCategoryId], references: [id])
}

model Order {
  id                 Int                @id @default(autoincrement())
  createdAt          DateTime           @default(now())
  serviceId          Int?
  categoryId         Int?
  medicalId          Int
  userId             Int
  price              Float              @default(0)
  address            String?
  lat                Float?
  lng                Float?
  entrance           String?
  floor              Int?
  apartment          String?
  intercom           String?
  paymetStatus       String             @default("pending")
  payment_order_id   String?
  orderStatus        String             @default("pending")
  employeeStatus     String             @default("pending")
  declinedReason     String?
  orderDate          DateTime
  additionalInfo     String?
  date               String?
  endTime            Int?
  startTime          Int?
  fileUrl            String?
  doctor             String?            @db.VarChar(255)
  forAnotherPerson  Boolean?          @default(false)
  forAnotherPersonName String?
  forAnotherPersonPhone String?
  refounded          Boolean?          @default(false)
  refoundedAmount    Float?           @default(0)
  Category           Category?          @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  medical            Medical            @relation(fields: [medicalId], references: [id])
  Service            Service?           @relation(fields: [serviceId], references: [id], onDelete: Restrict)
  user               User               @relation(fields: [userId], references: [id])
  orderSubCategories OrderSubCategory[]
  adminId            Int?
  admin              Admin?             @relation("AdminOrder", fields: [adminId], references: [id])
  employeeId         Int?
  employee           Employee?          @relation(fields: [employeeId], references: [id])
  paymentMethod      PaymentMethod?     @default(COD)
}

enum PaymentMethod {
  COD
  Card
}

model OrderSubCategory {
  orderId       Int
  subCategoryId Int
  serviceId     Int
  categoryId    Int
  id            Int         @id @default(autoincrement())
  category      Category    @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  order         Order       @relation(fields: [orderId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  service       Service     @relation(fields: [serviceId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subCategory   SubCategory @relation("SubCategoryOrderSubCategories", fields: [subCategoryId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "OrderSubCategory_subCategoryId_to_SubCategory")
}

model Availability {
  id         Int      @id @default(autoincrement())
  createdAt  DateTime @default(now())
  day        Int
  startTime  Int
  endTime    Int
  medicalId  Int?
  employeeId Int?
  medical    Medical?  @relation(fields: [medicalId], references: [id])
  employee   Employee? @relation(fields: [employeeId], references: [id])
}

model Address {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  shortName String
  city      String
  district  String
  address   String
  userId    Int
  lat       Float?
  lng       Float?
  entrance  String?
  floor     Int?
  apartment String?
  intercom  String?
  user      User     @relation(fields: [userId], references: [id])
}

model FcmToken {
  id     Int    @id @default(autoincrement())
  token  String @unique
  userId Int
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// New Admin model for admin panel authentication
model Admin {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  password  String
  name      String
  role      AdminRole @default(ADMIN)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  medical   Medical[] @relation("AdminMedical")
  orders    Order[]   @relation("AdminOrder")
}

enum AdminRole {
  ADMIN
  SUPER_ADMIN
}

model Employee {
  id        Int      @id @default(autoincrement())
  name      String
  surName   String
  position  String
  userId    Int      @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  medicalId Int?
  medical   Medical? @relation(fields: [medicalId], references: [id])
  availabilities Availability[]

  Order Order[]
}
