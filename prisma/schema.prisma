generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  Int       @id @default(autoincrement())
  email               String?   @unique
  password            String?
  mobileNumber        String?
  otp                 Int?
  name                String?
  surName             String?
  pytroNym            String?
  dob                 DateTime?
  address             String?   @default("None")
  authProvider        String
  googleId            String?
  notificationEnabled Boolean   @default(false)
  country             String?
  gender              String?
  lat                 Float?
  lng                 Float?
  isDeleted           Boolean?  @default(false)
  imageUrl            String?   @default("https://thumbs.dreamstime.com/b/profile-anonymous-face-icon-gray-silhouette-person-male-default-avatar-photo-placeholder-white-background-vector-illustration-106473768.jpg")
  addresses           Address[]
  orders              Order[]
  tokens              FcmToken[]
}

model Service {
  id         Int                @id @default(autoincrement())
  iconUrl    String
  name       String
  categories Category[]
  Order      Order[]
  orders     OrderSubCategory[]
}

model Category {
  id            Int                @id @default(autoincrement())
  iconUrl       String
  name          String
  serviceId     Int
  service       Service            @relation(fields: [serviceId], references: [id])
  Order         Order[]
  orders        OrderSubCategory[]
  subcategories SubCategory[]
}

model SubCategory {
  id                 Int                @id @default(autoincrement())
  iconUrl            String
  name               String
  categoryId         Int
  medicalCategories  MedicalCategory[]
  orderSubCategories OrderSubCategory[] @relation("SubCategoryOrderSubCategories")
  category           Category           @relation(fields: [categoryId], references: [id])
}

model Medical {
  id                Int               @id @default(autoincrement())
  iconUrl           String
  name              String
  lat               Float
  lng               Float
  address           String
  services          String?
  contact           Int?
  availabilities    Availability[]
  medicalCatrgories MedicalCategory[]
  orders            Order[]
}

model MedicalCategory {
  id            Int         @id @default(autoincrement())
  medicalId     Int
  subCategoryId Int
  createdAt     DateTime    @default(now())
  price         Float       @default(0)
  medical       Medical     @relation(fields: [medicalId], references: [id])
  subCategory   SubCategory @relation(fields: [subCategoryId], references: [id])
}

model Order {
  id                 Int                @id @default(autoincrement())
  createdAt          DateTime           @default(now())
  serviceId          Int?
  categoryId         Int?
  medicalId          Int
  userId             Int
  price              Float              @default(0)
  address            String?
  lat                Float?
  lng                Float?
  paymetStatus       String             @default("pending")
  orderStatus        String             @default("pending")
  declinedReason     String?
  orderDate          DateTime
  additionalInfo     String?
  date               String?
  endTime            Int?
  startTime          Int?
  fileUrl            String?
  doctor             String?            @db.VarChar(255)
  Category           Category?          @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  medical            Medical            @relation(fields: [medicalId], references: [id])
  Service            Service?           @relation(fields: [serviceId], references: [id], onDelete: Restrict)
  user               User               @relation(fields: [userId], references: [id])
  orderSubCategories OrderSubCategory[]
}

model OrderSubCategory {
  orderId       Int
  subCategoryId Int
  serviceId     Int
  categoryId    Int
  id            Int         @id @default(autoincrement())
  category      Category    @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  order         Order       @relation(fields: [orderId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  service       Service     @relation(fields: [serviceId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subCategory   SubCategory @relation("SubCategoryOrderSubCategories", fields: [subCategoryId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "OrderSubCategory_subCategoryId_to_SubCategory")
}

model Availability {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  day       Int
  startTime Int
  endTime   Int
  medicalId Int
  medical   Medical  @relation(fields: [medicalId], references: [id])
}

model Address {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  shortName String
  city      String
  district  String
  address   String
  userId    Int
  lat       Int
  lng       Int
  user      User     @relation(fields: [userId], references: [id])
}



model FcmToken{
    id        Int      @id @default(autoincrement())
    token String @unique
    userId Int
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}